# ‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å (Member Messaging System)

## ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°

‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏® ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡∏Å‡∏±‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô widget ‡πÅ‡∏•‡∏∞‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ

## ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥‡∏´‡∏•‡∏±‡∏Å

### üìß **‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°**
- ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ö‡∏ö‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡πâ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏ô
- ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ö‡∏ö broadcast ‡πÉ‡∏´‡πâ‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô
- ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏•‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó (info, warning, error, success, announcement)
- ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç (low, normal, high, urgent)
- ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° (general, system, promotion, security, update)

### üéØ **‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°**
- Template ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏£‡∏π‡∏õ
- ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° (scheduling)
- ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ß‡∏±‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
- ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô
- ‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà

### üë• **‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö**
- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏ô
- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≤‡∏°‡πÄ‡∏Å‡∏ì‡∏ë‡πå (level, ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£, etc.)
- ‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
- ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°

## ‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤

### 1. Database Migration

‡∏£‡∏±‡∏ô‡πÑ‡∏ü‡∏•‡πå migration ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô:

```sql
-- ‡∏£‡∏±‡∏ô‡πÑ‡∏ü‡∏•‡πå hacker-registration-system/supabase/migrations/004_messaging_system.sql
```

‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á:
- `messages` - ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏•‡∏±‡∏Å
- `message_templates` - template ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
- `broadcast_messages` - ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° broadcast
- `message_attachments` - ‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏ô‡∏ö
- `user_notification_preferences` - ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô

### 2. Widget Integration

‡πÄ‡∏û‡∏¥‡πà‡∏° MessageInbox component ‡πÉ‡∏ô widget:

```html
<script src="member-widget/src/components/MessageInbox.js"></script>
```

### 3. Admin Interface

‡πÄ‡∏û‡∏¥‡πà‡∏° MessageCenter component ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö admin:

```tsx
import MessageCenter from './components/admin/MessageCenter';

// ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÉ‡∏ô admin dashboard
<MessageCenter />
```

## ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Admin

### 1. ‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°

```typescript
// ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡πâ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏Ñ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
const { data, error } = await supabase.rpc('send_message_to_user', {
  p_recipient_id: 'user-uuid',
  p_title: '‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö!',
  p_content: '‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö',
  p_message_type: 'success',
  p_priority: 'normal',
  p_category: 'general',
  p_sender_name: 'Admin'
});
```

### 2. ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ Template

```typescript
// ‡πÉ‡∏ä‡πâ template ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà
const template = await supabase
  .from('message_templates')
  .select('*')
  .eq('name', 'Welcome Message')
  .single();

// ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÉ‡∏ô template
const personalizedTitle = template.title_template
  .replace('{{user_name}}', user.display_name);
  
const personalizedContent = template.content_template
  .replace('{{user_name}}', user.display_name)
  .replace('{{user_id}}', user.id);
```

### 3. ‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° Broadcast

```typescript
// ‡∏™‡∏£‡πâ‡∏≤‡∏á broadcast message
const { data: broadcast } = await supabase
  .from('broadcast_messages')
  .insert({
    title: '‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç',
    content: '‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏õ‡∏¥‡∏î‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 20 ‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°',
    message_type: 'announcement',
    priority: 'high',
    target_criteria: { hacker_level: { gte: 5 } }
  })
  .select()
  .single();

// ‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡πÄ‡∏Å‡∏ì‡∏ë‡πå
const users = await supabase
  .from('profiles')
  .select('id')
  .gte('hacker_level', 5);

for (const user of users.data) {
  await supabase.rpc('send_message_to_user', {
    p_recipient_id: user.id,
    p_title: broadcast.title,
    p_content: broadcast.content,
    p_message_type: broadcast.message_type,
    p_priority: broadcast.priority
  });
}
```

## ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Widget

### 1. ‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°

Widget ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡πà‡∏≤‡∏ô‡πÉ‡∏ô‡∏õ‡∏∏‡πà‡∏° Messages:

```javascript
// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà
const unreadCount = await supabase.rpc('get_unread_message_count');

// ‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô UI
if (unreadCount > 0) {
  button.textContent = `üìß Messages (${unreadCount})`;
  button.classList.add('has-notification');
}
```

### 2. ‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°

```javascript
// ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
const { data: messages } = await supabase
  .from('messages')
  .select('*')
  .eq('recipient_id', user.id)
  .order('created_at', { ascending: false });

// ‡∏°‡∏≤‡∏£‡πå‡∏Ñ‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß
await supabase.rpc('mark_message_as_read', {
  message_id: messageId
});
```

### 3. Event Listeners

```javascript
// ‡∏ü‡∏±‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà
document.addEventListener('memberWidget:unreadCountChanged', (event) => {
  const count = event.detail.count;
  updateNotificationBadge(count);
});
```

## Message Types ‡πÅ‡∏•‡∏∞ Styling

### ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°

```javascript
const messageTypes = {
  'info': {
    icon: '‚ÑπÔ∏è',
    color: '#0099ff',
    description: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ'
  },
  'warning': {
    icon: '‚ö†Ô∏è',
    color: '#ffaa00',
    description: '‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô'
  },
  'error': {
    icon: '‚ùå',
    color: '#ff4444',
    description: '‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î'
  },
  'success': {
    icon: '‚úÖ',
    color: '#00ff00',
    description: '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'
  },
  'announcement': {
    icon: 'üì¢',
    color: '#ff6b35',
    description: '‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®'
  }
};
```

### ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç

```javascript
const priorities = {
  'low': {
    color: '#888888',
    description: '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ï‡πà‡∏≥'
  },
  'normal': {
    color: '#ffffff',
    description: '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏õ‡∏Å‡∏ï‡∏¥'
  },
  'high': {
    color: '#ffaa00',
    description: '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏™‡∏π‡∏á'
  },
  'urgent': {
    color: '#ff4444',
    description: '‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô',
    effects: ['glow', 'pulse']
  }
};
```

## Templates ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÉ‡∏´‡πâ

### 1. Welcome Message
```
Title: Welcome to the System, {{user_name}}!
Content: Hello {{user_name}},

Welcome to our hacker registration system! Your account has been successfully created.

Your user ID: {{user_id}}
Registration date: {{registration_date}}

Get started by exploring the system and discovering hidden features.

Happy hacking!

The System
```

### 2. Security Alert
```
Title: Security Alert: {{alert_type}}
Content: SECURITY ALERT

Alert Type: {{alert_type}}
Detected at: {{detection_time}}
User: {{user_name}}
IP Address: {{ip_address}}

Details:
{{alert_details}}

If this was not you, please change your password immediately and contact support.

Stay secure!
Security Team
```

### 3. System Maintenance
```
Title: Scheduled Maintenance: {{maintenance_date}}
Content: SYSTEM MAINTENANCE NOTICE

Scheduled maintenance will occur on {{maintenance_date}} from {{start_time}} to {{end_time}}.

During this time:
- The system will be temporarily unavailable
- All sessions will be terminated
- Data will be safely preserved

Maintenance details:
{{maintenance_details}}

We apologize for any inconvenience.

System Administration
```

## API Functions

### Database Functions

```sql
-- ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
SELECT send_message_to_user(
  p_recipient_id := 'user-uuid',
  p_title := '‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°',
  p_content := '‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°',
  p_message_type := 'info',
  p_priority := 'normal',
  p_category := 'general'
);

-- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡πà‡∏≤‡∏ô
SELECT get_unread_message_count('user-uuid');

-- ‡∏°‡∏≤‡∏£‡πå‡∏Ñ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß
SELECT mark_message_as_read('message-uuid');

-- ‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏
SELECT cleanup_expired_messages();
```

### Widget API

```javascript
// ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á MessageInbox component
const messageInbox = widget.messageInbox;

// ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
await messageInbox.loadMessages();

// ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
await messageInbox.refreshMessages();

// ‡∏°‡∏≤‡∏£‡πå‡∏Ñ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß
await messageInbox.markAllAsRead();

// ‡πÄ‡∏õ‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
messageInbox.openMessage('message-id');
```

## ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á UI

### Custom CSS

```css
/* ‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏µ‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó */
.message-item.type-urgent {
  border-color: #ff4444;
  background: rgba(255, 68, 68, 0.1);
  animation: urgent-pulse 1s infinite;
}

.message-item.type-success {
  border-color: #00ff00;
  background: rgba(0, 255, 0, 0.1);
}

/* ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡∏õ‡∏∏‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° */
.action-btn.has-notification {
  position: relative;
}

.action-btn.has-notification::after {
  content: '';
  position: absolute;
  top: -2px;
  right: -2px;
  width: 8px;
  height: 8px;
  background: #ff4444;
  border-radius: 50%;
  animation: pulse 2s infinite;
}
```

### ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á Modal

```css
/* ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á message modal */
.message-modal {
  max-width: 800px;
  background: linear-gradient(45deg, #000000, #001100);
}

.message-modal .modal-header {
  background: linear-gradient(45deg, #001100, #002200);
  border-bottom: 2px solid #00ff00;
}

.message-modal .message-text {
  font-size: 14px;
  line-height: 1.8;
  color: #ffffff;
}
```

## Security ‡πÅ‡∏•‡∏∞ Best Practices

### 1. ‡∏Å‡∏≤‡∏£‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô XSS

```javascript
// Escape HTML content
function escapeHtml(text) {
  const div = document.createElement('div');
  div.textContent = text;
  return div.innerHTML;
}

// ‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
messageElement.innerHTML = escapeHtml(message.content);
```

### 2. Rate Limiting

```sql
-- ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
CREATE OR REPLACE FUNCTION check_message_rate_limit(sender_id UUID)
RETURNS BOOLEAN AS $$
DECLARE
  message_count INTEGER;
BEGIN
  SELECT COUNT(*) INTO message_count
  FROM messages 
  WHERE sender_id = sender_id 
  AND created_at > NOW() - INTERVAL '1 hour';
  
  RETURN message_count < 100; -- ‡∏à‡∏≥‡∏Å‡∏±‡∏î 100 ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πà‡∏≠‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á
END;
$$ LANGUAGE plpgsql;
```

### 3. Content Validation

```javascript
// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
function validateMessage(title, content) {
  const errors = [];
  
  if (!title || title.trim().length === 0) {
    errors.push('Title is required');
  }
  
  if (title && title.length > 255) {
    errors.push('Title too long (max 255 characters)');
  }
  
  if (!content || content.trim().length === 0) {
    errors.push('Content is required');
  }
  
  if (content && content.length > 10000) {
    errors.push('Content too long (max 10000 characters)');
  }
  
  return errors;
}
```

## ‡∏Å‡∏≤‡∏£ Monitor ‡πÅ‡∏•‡∏∞ Analytics

### 1. Message Statistics

```sql
-- ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
SELECT 
  message_type,
  priority,
  COUNT(*) as total_messages,
  COUNT(*) FILTER (WHERE is_read = true) as read_messages,
  COUNT(*) FILTER (WHERE is_read = false) as unread_messages,
  AVG(EXTRACT(EPOCH FROM (read_at - created_at))/60) as avg_read_time_minutes
FROM messages 
WHERE created_at >= NOW() - INTERVAL '30 days'
GROUP BY message_type, priority
ORDER BY total_messages DESC;
```

### 2. User Engagement

```sql
-- ‡∏Å‡∏≤‡∏£‡∏°‡∏µ‡∏™‡πà‡∏ß‡∏ô‡∏£‡πà‡∏ß‡∏°‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
SELECT 
  u.email,
  p.display_name,
  ms.total_messages,
  ms.unread_messages,
  ms.last_message_at,
  CASE 
    WHEN ms.unread_messages = 0 THEN 'Active Reader'
    WHEN ms.unread_messages <= 5 THEN 'Occasional Reader'
    ELSE 'Inactive Reader'
  END as engagement_level
FROM auth.users u
JOIN profiles p ON u.id = p.id
LEFT JOIN message_statistics ms ON u.id = ms.recipient_id
ORDER BY ms.total_messages DESC;
```

## Troubleshooting

### ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö‡∏ö‡πà‡∏≠‡∏¢

#### 1. ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô Widget
```javascript
// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Supabase
console.log('Supabase client:', widget.supabaseClient);
console.log('Current user:', widget.user);

// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö RLS policies
const { data, error } = await supabase
  .from('messages')
  .select('*')
  .eq('recipient_id', user.id);
  
console.log('Messages query result:', { data, error });
```

#### 2. ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
```javascript
// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö event listeners
document.addEventListener('memberWidget:unreadCountChanged', (event) => {
  console.log('Unread count changed:', event.detail.count);
});

// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï unread count
await messageInbox.updateUnreadCount();
```

#### 3. Template Variables ‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
```javascript
// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£
function replaceTemplateVariables(template, variables) {
  let result = template;
  
  Object.keys(variables).forEach(key => {
    const placeholder = `{{${key}}}`;
    result = result.replace(new RegExp(placeholder, 'g'), variables[key]);
  });
  
  console.log('Template result:', result);
  return result;
}
```

## ‡∏Å‡∏≤‡∏£‡∏Ç‡∏¢‡∏≤‡∏¢‡∏£‡∏∞‡∏ö‡∏ö

### 1. ‡πÄ‡∏û‡∏¥‡πà‡∏° Message Types ‡πÉ‡∏´‡∏°‡πà

```sql
-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà
ALTER TABLE messages 
DROP CONSTRAINT valid_message_type;

ALTER TABLE messages 
ADD CONSTRAINT valid_message_type 
CHECK (message_type IN ('info', 'warning', 'error', 'success', 'announcement', 'promotion', 'reminder'));
```

### 2. ‡πÄ‡∏û‡∏¥‡πà‡∏° Rich Text Support

```javascript
// ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Markdown
import { marked } from 'marked';

function renderMessageContent(content, format = 'text') {
  if (format === 'markdown') {
    return marked(content);
  }
  return escapeHtml(content);
}
```

### 3. ‡πÄ‡∏û‡∏¥‡πà‡∏° Push Notifications

```javascript
// Service Worker ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö push notifications
self.addEventListener('push', function(event) {
  const data = event.data.json();
  
  const options = {
    body: data.content,
    icon: '/icon-192x192.png',
    badge: '/badge-72x72.png',
    tag: 'member-message',
    data: {
      messageId: data.messageId,
      url: '/messages'
    }
  };
  
  event.waitUntil(
    self.registration.showNotification(data.title, options)
  );
});
```

‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡∏Å‡∏±‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û ‡πÅ‡∏•‡∏∞‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏ú‡πà‡∏≤‡∏ô widget!